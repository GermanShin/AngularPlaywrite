version: 0.2

phases:
    install:
        runtime-versions:
            nodejs: 22
        commands:
            - echo "Installing Node.js version 22 ..."
            - cd TestAutomation
            - npm ci
            - npx playwright install
    build:
        commands:
            - cd cdk1
            - 'echo "Current dir: $(pwd)"'
            - npm ci
            - npm run build
            - npx cdk synth
            - npx cdk deploy --require-approval=never
    post_build:
        commands:
            - cd $CODEBUILD_SRC_DIR/TestAutomation
            - 'echo "Current dir: $(pwd)"'
            - echo "Running Playwright tests"
            - npx playwright test
